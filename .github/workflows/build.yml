name: Build APK
on: [push]
jobs:
  build:
    runs-on: ubuntu-22.04  # استفاده از نسخه پایدار
    timeout-minutes: 90
    steps:
      - uses: actions/checkout@v4
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            python3-pip \
            python3-dev \
            openjdk-11-jdk \
            wget unzip git \
            zlib1g-dev \
            ccache
          pip3 install --upgrade pip
          pip3 install buildozer cython==0.29.33
      - name: Accept Android Licenses
        run: |
          mkdir -p ~/.android
          touch ~/.android/repositories.cfg
          yes | $HOME/.buildozer/android/platform/android-sdk/tools/bin/sdkmanager --licenses || true
      - name: Build APK
        run: |
          buildozer android debug 2>&1 | tail -50
        timeout-minutes: 60
      - name: Upload APK
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: app
          path: bin/*.apk
          retention-days: 7
